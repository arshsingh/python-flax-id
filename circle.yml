machine:
  pre:
    - cd /opt/circleci/.pyenv/plugins/python-build/../.. && git pull && cd -
  python:
    version: 3.5.5
  timezone:
    America/Los_Angeles

dependencies:
  override:
    - pip install -U pip wheel
    - make
    - pyenv local 2.7.11 3.5.5

test:
  override:
    - TEST_ARGS=--with-xunit make test

  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - "[ -r nosetests.xml ] && mv nosetests.xml $CIRCLE_TEST_REPORTS/junit/ || :"

deployment:
  release:
    tag: /v\d+.\d+.\d+.*/
    commands:
      - make deploy
